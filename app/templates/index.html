{% extends "layout/base.html" %}

{% block head %}
	{{ super() }}
	<style>
	   #map {
			height: 400px;
			width: 100%;
	   }
	</style>
{% endblock %}

{% block content %}

	 <h1 class="ui header">{{ title }}</h1>

	{% if current_user.is_authenticated %}
		<h2 class="ui header">Hi {{ current_user.name }}!</h2>
	{% endif %}

	<div id="map"></div>
	<script>

	function initMap() {

		$.ajax({
		    url: "{{ url_for('userbp.users') }}" + "?page=" + this.page,
		    type: 'GET'
		}).done(data => {
			var users = data;
			 map = new google.maps.Map(document.getElementById('map'), {
	          center: {lat: 14.551335, lng: 120.9871093},
	          zoom: 16
	        });

	        infoWindow = new google.maps.InfoWindow;

	        var marker = new google.maps.Marker({
				  position: {lat: 14.551335, lng: 120.9871093},
				  animation: google.maps.Animation.BOUNCE,
				  map: map
			});

	   //      // Try HTML5 geolocation.
	   //      if (navigator.geolocation) {
	   //        navigator.geolocation.getCurrentPosition(function(position) {
	   //          var pos = {
	   //            lat: position.coords.latitude,
	   //            lng: position.coords.longitude
	   //          };

	   //          map.setCenter(pos);
	   //          map.setZoom(17);

	   //          var marker = new google.maps.Marker({
				//   position: pos,
				//   animation: google.maps.Animation.BOUNCE,
				//   map: map
				// });


	   //        }, function() {
	   //          handleLocationError(true, infoWindow, map.getCenter());
	   //        });
	   //      } else {
	   //        // Browser doesn't support Geolocation
	   //        handleLocationError(false, infoWindow, map.getCenter());
	   //      }

			users.forEach(function(markerElem) {
			    var profession = markerElem.profession;
			    var name = markerElem.first_name + " " + markerElem.last_name;
			    var gender = markerElem.gender;
			    var point = new google.maps.LatLng(
			    	parseFloat(markerElem.lat),
			    	parseFloat(markerElem.lng));

			    var infowincontent = document.createElement('div');
			    var strong = document.createElement('strong');
			    strong.textContent = name;
			    infowincontent.appendChild(strong);
	            infowincontent.appendChild(document.createElement('br'));

	            var text = document.createElement('text');
	            text.textContent = profession;
	            infowincontent.appendChild(text);

			    var icon = profession[0] || {};
			    var marker = new google.maps.Marker({
			    	map: map,
			    	position: point,
			    	label: icon,
			    	title: profession
			    });
			    marker.addListener('click', function(){
			    	infoWindow.setContent(infowincontent);
			    	infoWindow.open(map, marker);
			    });
			});
		});

      
		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
			infoWindow.setPosition(pos);
			infoWindow.setContent(browserHasGeolocation ?
			                      'Error: The Geolocation service failed.' :
			                      'Error: Your browser doesn\'t support geolocation.');
			infoWindow.open(map);
		}
	}

    </script>
	<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2BM7sr0ZQkYiZbUdOxzNtKEWQPJBUp0M&callback=initMap">
	</script>
	
{% endblock %}
